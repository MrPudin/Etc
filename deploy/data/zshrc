
# zshrc
# ZSH Configuration file
#

#Paths
export PATH="$HOME/.rvm/bin:$PATH"
export PATH="$HOME/bin:/usr/local/bin:$PATH"
export MANPATH="/usr/local/man:$MANPATH"
export SSH_KEY_PATH="~/.ssh/rsa_id"
export PGDATA="/usr/local/var/postgres"

#Locale
export LANG="en_US.UTF-8"
export LC_ALL="en_US.UTF-8"

#Programs
if [[ -n $SSH_CONNECTION ]]; then
    export EDITOR='vim'
    export VISUAL="vim"
else
    export EDITOR='nvim'
    export VISUAL="nvim"
fi
alias vim="nvim"
alias py="python3"

# Compilation flags
export ARCHFLAGS="-arch x86_64"

#Plugin Configuration
HISTFILE="$HOME/.zsh_history"
HIST_STAMPS="dd/mm/yyyy"
HISTSIZE=100000
SAVEHIST=100000
setopt share_history
setopt inc_append_history

source ~/.zplug/init.zsh
zplug "plugins/vi-mode", from:oh-my-zsh
zplug "plugins/git-fast", from:oh-my-zsh
zplug "plugins/tmux", from:oh-my-zsh
zplug "mafredri/zsh-async"
zplug "miekg/lean", as:theme, use:"lean.plugin.zsh"

ZSH_TMUX_AUTOSTART=true

#Lean Prompt Configuration
prompt_lean_python_venv_status()
{
    # Support for Python Virtual Enviroment
    if [ -n "$VIRTUAL_ENV" ]
    then 
        printf " venv "
    fi
}

PROMPT_LEAN_TMUX=">"
PROMPT_LEAN_VIMODE="1"
PROMPT_LEAN_NOTITLE="1"
PROMPT_LEAN_NOTITLE="1"
PROMPT_LEAN_COLOR1="136"
PROMPT_LEAN_COLOR2="61"
PROMPT_LEAN_RIGHT="prompt_lean_python_venv_status"

zplug load #Load Plugins

# Lazy Load Implmentation
# Usage: lazy(load_cmd, activator, activators...)
lazy_load()
{
    load_cmd="$1";shift
    activator="$2";shift

    for act_alias in $*
    do
        unalias "$act_alias"
    done

    eval " $load_cmd"
    eval " $activator"
}

# Usage: lazy(load_cmd, activators...)
# Mitigates the unnecessary overhead of the the 'load_cmd' on startup, only
# runs the load command if the user touches any of the 'activators' aliases,
# then which the lazy loader actually loads the load command.
# activators is a space seperated string of activation alias that will cause
# the load command to run, thereafter activator command will run.
# 
lazy()
{
    load_cmd="$1"
    shift
    for activator in $*
    do
        load_alias="`printf 'lazy_load "%s" "%s" %s\n' "$load_cmd" "$activator" "$*"`"
        alias "$activator"="$load_alias"
    done 
}

#External Scripts
lazy "source $HOME/.rvm/scripts/rvm" rvm ruby
